//- {% comment %}
//- 	A word on drop-down menus: Shopify has no concept of them.
//- 	Drop-down menus in Shopify themes are a hack that relies on a naming convention.
//- 	To create a drop-down menu, the merchant must create a link list that has the same name as the link he wants the drop-down for.
//- 	For example, if he wants a drop-down under a 'Shop by brand' link (say, he has such link in his Main Menu), he needs to create a linklist called 'Shop by brand', and populate it with links. Once he has done that, there'll be a drop-down under 'Shop by brand'.
//- 	Shopify has a visual how-to guide here: http://docs.shopify.com/manual/your-website/navigation/create-drop-down-menu.
//- 	The naming convention hack won't work well if a shop's navigation uses non-English characters. There's a much more verbose coding solution that handles non-English characters here: http://docs.shopify.com/manual/configuration/store-customization/currencies-and-translations/translations/can-i-have-drop-down-menus-that-use-non-english-characters.
//- 	A word on sub-categories: Shopify manages sub-categories using product tags: http://docs.shopify.com/manual/configuration/store-customization/page-specific/collections/subcategories
//- {% endcomment %}

nav.site-nav
	ul.site-nav__list
		| {% for link in linklists.main-menu.links %}
		| {% assign has_sub_menu = false %}
		| {% assign has_sub_categories = false %}
		| {% assign parent_link_active = false %}
		| {% assign child_list_handle = link.title | handle %}
		| {% if linklists[child_list_handle] and linklists[child_list_handle].links.size > 0 %}
		|	{% assign has_sub_menu = true %}
		|	{% for l in linklists[child_list_handle].links %}
		|		{% if handle != blank and handle == l.object.handle %}
		|			{% assign parent_link_active = true %}
		|		{% elsif page_title == l.title %}
		|			{% assign parent_link_active = true %}
		|		{% endif %}
		|	{% endfor %}
		| {% elsif link.type == 'collection_link' and link.object.all_tags.size > 0 %}
		|	{% assign has_sub_categories = true %}
		| {% endif %}
		li(class="site-nav__item {% if link.active or parent_link_active %} site-nav__item--active{% endif %}{% if has_sub_menu or has_sub_categories %} site-nav__item--has-dropdown{% endif %}{% if forloop.first %} site-nav__item--first{% elsif forloop.last %} site-nav__item--last{% endif %}")
			a.site-nav__link(href="{{ link.url }}")
				| {{ link.title }}
				| {% if has_sub_menu or has_sub_categories %}
				i.fafa-angle-down
				| {% endif %}
			| {% if has_sub_menu or has_sub_categories %}
			ul.site-nav__sub-menu
				| {% if has_sub_menu %}
				|	{% for l in linklists[child_list_handle].links %}
				li.site-nav__sub-item(class="{% if l.active %} site-nav__sub-item--active{% endif %}")
					a.site-nav__sub-link(href="{{ l.url }}")
						| {{ l.title }}

				|	{% endfor %}
				| {% elsif has_sub_categories %}
				|	{% for tag in link.object.all_tags %}
				li(class="{% if current_tags contains tag %} active{% endif %}")
					a(href="{{ link.url }}/{{ tag | handle }}")
						| {{ tag }}

				|	{% endfor %}
				| {% endif %}

			| {% endif %}

		| {% endfor %}
		li.site-nav__search(class="{% if template == 'search' %} active{% endif %}")
			a.site-nav__search-link(href="/search")
				i.site-nav__search-icon.fa.fa-search